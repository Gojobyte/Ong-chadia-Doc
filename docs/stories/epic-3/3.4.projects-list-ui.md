# Story 3.4: Projects List UI

## Status: Complete

## Story

**As a** utilisateur authentifié,
**I want** voir la liste de tous les projets auxquels j'ai accès dans une interface moderne,
**so that** je puisse naviguer rapidement vers les projets qui m'intéressent et avoir une vue d'ensemble de l'activité projet de l'ONG.

## Acceptance Criteria

1. Page `/projects` accessible depuis la navigation principale
2. Vue liste/cards affichant: Nom, Statut (badge coloré), Dates début/fin, Budget formaté, Nombre de membres
3. Filtres fonctionnels: par statut (multi-select), par période (en cours, à venir, terminés, tous)
4. Recherche textuelle par nom de projet (debounced 300ms)
5. Tri par: nom (A-Z, Z-A), date de début (récent/ancien), statut
6. Pagination avec navigation (précédent/suivant, numéros de page)
7. Bouton "Nouveau projet" visible uniquement pour Staff+ (basé sur rôle user)
8. Clic sur une card/ligne navigue vers `/projects/:id`
9. Badge/indicateur visuel pour projets où l'utilisateur est assigné ("Mes projets")
10. État vide avec illustration et message si aucun projet
11. Loading skeleton pendant chargement
12. Responsive: cards sur mobile, tableau optionnel sur desktop

## Tasks / Subtasks

- [x] **Task 1: Service Frontend Projects** (AC: 2-6)
  - [x] Créer `apps/web/src/services/projects.service.ts`
  - [x] `getProjects(filters)` - Appel API avec query params
  - [x] `getProject(id)` - Détail projet
  - [x] Types depuis `@shared/types`

- [x] **Task 2: Hook useProjects** (AC: 2-6, 11)
  - [x] Créer `apps/web/src/hooks/useProjects.ts`
  - [x] TanStack Query pour fetch liste
  - [x] Gestion pagination, filtres, tri
  - [x] États: loading, error, data

- [x] **Task 3: Page ProjectsPage** (AC: 1, 10, 11)
  - [x] Créer `apps/web/src/pages/ProjectsPage.tsx`
  - [x] Layout avec header "Projets"
  - [x] Intégration hook useProjects
  - [x] Empty state avec illustration
  - [x] Loading skeleton grid/list

- [x] **Task 4: Composant ProjectsToolbar** (AC: 3, 4, 5, 7)
  - [x] Créer `apps/web/src/components/projects/ProjectsToolbar.tsx`
  - [x] Barre de recherche avec debounce (useDebounce hook)
  - [x] Dropdown filtres statut (multi-select)
  - [x] Dropdown tri
  - [x] Bouton "Nouveau projet" conditionnel (Staff+)

- [x] **Task 5: Composant ProjectCard** (AC: 2, 8, 9)
  - [x] Créer `apps/web/src/components/projects/ProjectCard.tsx`
  - [x] Affichage: nom, statut badge, dates, budget, membres count
  - [x] Badge "Mon projet" si user est membre
  - [x] Clic → navigation vers détail
  - [x] Hover state

- [x] **Task 6: Composant ProjectStatusBadge** (AC: 2)
  - [x] Créer `apps/web/src/components/projects/ProjectStatusBadge.tsx`
  - [x] Couleurs par statut:
    - DRAFT: gray
    - PREPARATION: blue
    - IN_PROGRESS: green
    - COMPLETED: purple
    - CANCELLED: red

- [x] **Task 7: Composant ProjectsGrid** (AC: 2, 12)
  - [x] Créer `apps/web/src/components/projects/ProjectsGrid.tsx`
  - [x] Grid responsive de ProjectCards
  - [x] 1 col mobile, 2 cols tablet, 3 cols desktop

- [x] **Task 8: Composant Pagination** (AC: 6)
  - [x] Créer `apps/web/src/components/projects/ProjectsPagination.tsx`
  - [x] Affichage: "Page X sur Y"
  - [x] Boutons prev/next + numéros

- [x] **Task 9: Navigation & Route** (AC: 1)
  - [x] Ajouter route `/projects` dans App.tsx
  - [x] Activer lien "Projets" dans Sidebar
  - [x] Icône: FolderKanban

- [x] **Task 10: Empty State** (AC: 10)
  - [x] Créer `apps/web/src/components/projects/ProjectsEmptyState.tsx`
  - [x] Illustration + texte "Aucun projet trouvé"
  - [x] CTA "Créer un projet" si Staff+

## Dev Notes

### Architecture Frontend

```text
apps/web/src/
├── pages/
│   └── ProjectsPage.tsx
├── components/projects/
│   ├── ProjectCard.tsx
│   ├── ProjectsGrid.tsx
│   ├── ProjectsToolbar.tsx
│   ├── ProjectStatusBadge.tsx
│   ├── ProjectsEmptyState.tsx
│   └── index.ts
├── hooks/
│   └── useProjects.ts
└── services/
    └── projects.service.ts
```

### Design Inspiration

Inspiré de:
- **Asana**: Cards projets avec progress indicator
- **Monday.com**: Badges colorés par statut
- **Notion**: Layout clean, filtres inline

### Couleurs Statut (Tailwind)

```typescript
const statusColors: Record<ProjectStatus, string> = {
  DRAFT: 'bg-gray-100 text-gray-800',
  PREPARATION: 'bg-blue-100 text-blue-800',
  IN_PROGRESS: 'bg-green-100 text-green-800',
  COMPLETED: 'bg-purple-100 text-purple-800',
  CANCELLED: 'bg-red-100 text-red-800',
};
```

### Format Budget

```typescript
const formatBudget = (amount: number | null): string => {
  if (!amount) return '-';
  return new Intl.NumberFormat('fr-FR', {
    style: 'currency',
    currency: 'XAF', // Franc CFA ou EUR selon config
    maximumFractionDigits: 0,
  }).format(amount);
};
```

### Query Params Structure

```typescript
interface ProjectsFilters {
  search?: string;
  status?: ProjectStatus[];
  period?: 'current' | 'upcoming' | 'completed' | 'all';
  sort?: 'name' | 'startDate' | 'status';
  order?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}
```

## Testing

### Localisation
- `apps/web/tests/ProjectsPage.test.tsx`

### Cas de test (Vitest + Testing Library)

| Test | Description |
|------|-------------|
| Render liste | Affiche les projets retournés par l'API |
| Filtrage statut | Filtre et re-fetch avec status param |
| Recherche | Debounce 300ms, fetch avec search param |
| Pagination | Navigation entre pages |
| Empty state | Affiche message si aucun projet |
| Bouton nouveau | Visible pour Staff, masqué pour Contributor |
| Click card | Navigation vers /projects/:id |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Création initiale | Sarah (PO) |
| 2025-01-27 | 1.1 | Implémentation complète - Dev Agent | Claude Opus 4.5 |
| 2025-01-27 | 1.2 | PO Review - Approved → Complete | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- TypeScript: `pnpm tsc --noEmit` - Pass

### Completion Notes List
- Service projects.service.ts avec getAll, getById, create, update, delete
- Hook useProjects avec TanStack Query, mutations et cache optimisé
- ProjectsPage avec filtres, recherche debounced, pagination
- ProjectsToolbar avec multi-select statut, tri, bouton Staff+
- ProjectCard avec badge statut, stats, hover animation
- Grid responsive: 1/2/3 colonnes
- Empty states: no-projects, no-results
- Loading skeleton avec animation

### File List
- `apps/web/src/services/projects.service.ts` - NEW
- `apps/web/src/hooks/useProjects.ts` - NEW
- `apps/web/src/pages/ProjectsPage.tsx` - NEW
- `apps/web/src/components/projects/ProjectCard.tsx` - NEW
- `apps/web/src/components/projects/ProjectsGrid.tsx` - NEW
- `apps/web/src/components/projects/ProjectsToolbar.tsx` - NEW
- `apps/web/src/components/projects/ProjectStatusBadge.tsx` - NEW
- `apps/web/src/components/projects/ProjectsEmptyState.tsx` - NEW
- `apps/web/src/components/projects/ProjectsPagination.tsx` - NEW
- `apps/web/src/components/projects/ProjectsSkeleton.tsx` - NEW
- `apps/web/src/components/projects/index.ts` - NEW
- `apps/web/src/App.tsx` - Route /projects ajoutée
- `apps/web/src/components/layout/Sidebar.tsx` - Lien Projets activé

---

## QA Results

### PO Review - 2025-01-27

**Reviewer:** Sarah (PO)

**Acceptance Criteria Verification:**

| AC | Description | Status | Notes |
|----|-------------|--------|-------|
| 1 | Page /projects accessible | ✅ PASS | Route ajoutée, Sidebar activé |
| 2 | Vue cards: nom, statut badge, dates, budget, membres | ✅ PASS | ProjectCard complet |
| 3 | Filtres statut multi-select | ✅ PASS | Dropdown avec checkboxes |
| 4 | Recherche debounced 300ms | ✅ PASS | useDebounce hook |
| 5 | Tri nom/date/statut | ✅ PASS | Dropdown tri avec toggle asc/desc |
| 6 | Pagination | ✅ PASS | ProjectsPagination avec numéros |
| 7 | Bouton "Nouveau projet" Staff+ | ✅ PASS | Conditionnel basé sur rôle |
| 8 | Clic card → /projects/:id | ✅ PASS | useNavigate |
| 9 | Badge "Mon projet" | ✅ PASS | isMyProject prop (API intégration pending) |
| 10 | Empty state | ✅ PASS | no-projects et no-results |
| 11 | Loading skeleton | ✅ PASS | ProjectsSkeleton avec animation |
| 12 | Responsive grid | ✅ PASS | 1/2/3 cols selon breakpoint |

**Score:** 12/12 AC satisfaits

**Decision:** ✅ **APPROVED** - Story marquée Complete
