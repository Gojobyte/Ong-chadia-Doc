# Story 3.5: Project Detail UI

## Status: Complete

## Story

**As a** membre d'un projet ou utilisateur Staff,
**I want** voir tous les dÃ©tails d'un projet sur une page dÃ©diÃ©e avec sections organisÃ©es,
**so that** j'aie une vue complÃ¨te du projet, de son Ã©quipe, ses documents et son avancement pour prendre des dÃ©cisions Ã©clairÃ©es.

## Acceptance Criteria

1. Page `/projects/:id` affichant les informations complÃ¨tes du projet
2. Header: Nom du projet, Statut (badge Ã©ditable pour Staff+), Dates dÃ©but/fin
3. Section "Description" avec texte formatÃ© (markdown support optionnel)
4. Section "Budget" affichant le montant formatÃ© en devise locale
5. Section "Ã‰quipe" listant tous les membres avec: photo/avatar, nom, rÃ´le projet, date assignation
6. Section "Documents" listant les documents liÃ©s avec: nom, type (icÃ´ne), taille, lien vers GED
7. Section "Avancement" avec indicateur visuel de la phase actuelle (timeline/stepper)
8. Bouton "Modifier" (Staff+ ou PROJECT_MANAGER) ouvrant page/modal d'Ã©dition
9. Bouton "GÃ©rer l'Ã©quipe" ouvrant le panneau d'assignation (Story 3.7)
10. Breadcrumb: Projets > Nom du projet
11. Loading state et error handling
12. 404 page si projet non trouvÃ©

## Tasks / Subtasks

- [x] **Task 1: Hook useProject** (AC: 1, 11, 12)
  - [x] Hook `useProject` dÃ©jÃ  dans `useProjects.ts`
  - [x] Ajout hooks: `useProjectMembers`, `useProjectDocuments`
  - [x] TanStack Query pour fetch dÃ©tail
  - [x] Mutations pour membres et documents

- [x] **Task 2: Page ProjectDetailPage** (AC: 1, 10, 11, 12)
  - [x] CrÃ©er `apps/web/src/pages/ProjectDetailPage.tsx`
  - [x] Layout avec sections grid
  - [x] Breadcrumb avec Link
  - [x] Loading skeleton (ProjectDetailSkeleton)
  - [x] 404 display avec bouton retour

- [x] **Task 3: Composant ProjectHeader** (AC: 2, 8)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectHeader.tsx`
  - [x] Titre projet avec dates formatÃ©es
  - [x] StatusBadge cliquable â†’ dropdown changement statut
  - [x] Boutons: Modifier, GÃ©rer Ã©quipe (conditionnels)

- [x] **Task 4: Composant ProjectDescription** (AC: 3)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectDescription.tsx`
  - [x] Card avec icÃ´ne et titre
  - [x] Texte ou placeholder "Aucune description"

- [x] **Task 5: Composant ProjectBudget** (AC: 4)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectBudget.tsx`
  - [x] Card avec montant formatÃ© XAF
  - [x] Placeholder si non dÃ©fini

- [x] **Task 6: Composant ProjectTeam** (AC: 5, 9)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectTeam.tsx`
  - [x] Liste membres avec avatars initiales
  - [x] Badge rÃ´le colorÃ© (PM/Member/Volunteer)
  - [x] Highlight utilisateur courant
  - [x] Bouton "GÃ©rer" conditionnel

- [x] **Task 7: Composant ProjectDocuments** (AC: 6)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectDocuments.tsx`
  - [x] Liste 5 premiers documents
  - [x] IcÃ´ne par type MIME
  - [x] Clic â†’ navigation GED
  - [x] Bouton "Lier documents" conditionnel

- [x] **Task 8: Composant ProjectProgress** (AC: 7)
  - [x] CrÃ©er `apps/web/src/components/projects/ProjectProgress.tsx`
  - [x] Stepper horizontal avec ligne de progression
  - [x] 4 phases: Draft â†’ Prep â†’ InProgress â†’ Complete
  - [x] Phase active avec cercle colorÃ©
  - [x] CANCELLED avec affichage spÃ©cial (icÃ´ne X rouge)

- [x] **Task 9: Route & Navigation** (AC: 1)
  - [x] Route `/projects/:id` dans App.tsx
  - [x] Lazy loading avec Suspense
  - [x] useParams pour rÃ©cupÃ©rer id

- [x] **Task 10: Permissions UI** (AC: 8, 9)
  - [x] VÃ©rification: Staff+ OU PROJECT_MANAGER
  - [x] Boutons Modifier/GÃ©rer conditionnels
  - [x] Bouton Lier documents pour membres

## Dev Notes

### Architecture Frontend

```text
apps/web/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ ProjectsPage.tsx
â”‚   â””â”€â”€ ProjectDetailPage.tsx
â”œâ”€â”€ components/projects/
â”‚   â”œâ”€â”€ ProjectHeader.tsx
â”‚   â”œâ”€â”€ ProjectDescription.tsx
â”‚   â”œâ”€â”€ ProjectBudget.tsx
â”‚   â”œâ”€â”€ ProjectTeam.tsx
â”‚   â”œâ”€â”€ ProjectDocuments.tsx
â”‚   â”œâ”€â”€ ProjectProgress.tsx
â”‚   â”œâ”€â”€ ProjectStatusBadge.tsx
â”‚   â””â”€â”€ index.ts
â””â”€â”€ hooks/
    â”œâ”€â”€ useProjects.ts
    â””â”€â”€ useProject.ts
```

### Layout Page

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Breadcrumb: Projets > Projet Alpha          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Header]                                    â”‚
â”‚ Projet Alpha          [IN_PROGRESS â–¼]       â”‚
â”‚ 15 Jan 2025 â†’ 15 Dec 2025     [Modifier]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Description     â”‚ â”‚ Budget              â”‚ â”‚
â”‚ â”‚ Lorem ipsum...  â”‚ â”‚ 15 000 000 XAF      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Progress Stepper]                          â”‚
â”‚ â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—‹                               â”‚
â”‚ Draft Prep InProg Complete                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ã‰quipe (5)      â”‚ â”‚ Documents (12)      â”‚ â”‚
â”‚ â”‚ ğŸ‘¤ Alice (PM)   â”‚ â”‚ ğŸ“„ Budget.xlsx      â”‚ â”‚
â”‚ â”‚ ğŸ‘¤ Bob (Member) â”‚ â”‚ ğŸ“„ Contrat.pdf      â”‚ â”‚
â”‚ â”‚ [GÃ©rer]         â”‚ â”‚ [Lier documents]    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Response Expected

```typescript
interface ProjectDetail {
  id: string;
  name: string;
  description: string | null;
  status: ProjectStatus;
  startDate: string | null;
  endDate: string | null;
  budget: number | null;
  createdBy: { id: string; name: string };
  members: Array<{
    id: string;
    user: { id: string; name: string; email: string; avatar?: string };
    role: ProjectRole;
    assignedAt: string;
  }>;
  documents: Array<{
    id: string;
    document: { id: string; name: string; mimeType: string; size: number };
    linkedAt: string;
  }>;
  _count: { members: number; documents: number };
}
```

### Permission Check

```typescript
const canEditProject = (user: User, project: ProjectDetail): boolean => {
  // Staff ou Super-Admin
  if (['STAFF', 'SUPER_ADMIN'].includes(user.role)) return true;

  // PROJECT_MANAGER du projet
  const membership = project.members.find(m => m.user.id === user.id);
  return membership?.role === 'PROJECT_MANAGER';
};
```

## Testing

### Localisation
- `apps/web/tests/ProjectDetailPage.test.tsx`

### Cas de test

| Test | Description |
|------|-------------|
| Render page | Affiche toutes les sections |
| Loading state | Skeleton pendant fetch |
| 404 | Affiche erreur si projet non trouvÃ© |
| Permissions Staff | Boutons Modifier/GÃ©rer visibles |
| Permissions Contributor | Boutons masquÃ©s |
| Click document | Navigation vers GED |
| Breadcrumb | Navigation vers liste projets |

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | CrÃ©ation initiale | Sarah (PO) |
| 2025-01-27 | 1.1 | ImplÃ©mentation complÃ¨te - Dev Agent | Claude Opus 4.5 |
| 2025-01-27 | 1.2 | PO Review - Approved â†’ Complete | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- TypeScript: `pnpm tsc --noEmit` - Pass

### Completion Notes List
- Service projects.service.ts Ã©tendu avec mÃ©thodes membres/documents
- Hook useProjects Ã©tendu avec useProjectMembers, useProjectDocuments et mutations
- ProjectHeader avec dropdown status Ã©ditable pour Staff+
- ProjectProgress avec stepper horizontal animÃ©
- ProjectTeam avec avatars initiales et highlight utilisateur courant
- ProjectDocuments avec icÃ´nes par type MIME
- 404 page avec design cohÃ©rent
- Loading skeletons pour toutes les sections

### File List
- `apps/web/src/services/projects.service.ts` - Extended
- `apps/web/src/hooks/useProjects.ts` - Extended
- `apps/web/src/pages/ProjectDetailPage.tsx` - NEW
- `apps/web/src/components/projects/ProjectHeader.tsx` - NEW
- `apps/web/src/components/projects/ProjectDescription.tsx` - NEW
- `apps/web/src/components/projects/ProjectBudget.tsx` - NEW
- `apps/web/src/components/projects/ProjectProgress.tsx` - NEW
- `apps/web/src/components/projects/ProjectTeam.tsx` - NEW
- `apps/web/src/components/projects/ProjectDocuments.tsx` - NEW
- `apps/web/src/components/projects/ProjectDetailSkeleton.tsx` - NEW
- `apps/web/src/components/projects/index.ts` - Updated
- `apps/web/src/App.tsx` - Route /projects/:id ajoutÃ©e

---

## QA Results

### PO Review - 2025-01-27

**Reviewer:** Sarah (PO)

**Acceptance Criteria Verification:**

| AC | Description | Status | Notes |
|----|-------------|--------|-------|
| 1 | Page /projects/:id | âœ… PASS | Route lazy-loaded |
| 2 | Header: nom, statut badge Ã©ditable, dates | âœ… PASS | Dropdown status pour Staff+/PM |
| 3 | Section Description | âœ… PASS | Card avec placeholder si vide |
| 4 | Section Budget formatÃ© | âœ… PASS | Format XAF avec Intl |
| 5 | Section Ã‰quipe | âœ… PASS | Avatars, rÃ´les, highlight user |
| 6 | Section Documents | âœ… PASS | IcÃ´nes MIME, navigation GED |
| 7 | Section Avancement stepper | âœ… PASS | 4 phases, CANCELLED spÃ©cial |
| 8 | Bouton Modifier conditionnel | âœ… PASS | Staff+ ou PROJECT_MANAGER |
| 9 | Bouton GÃ©rer Ã©quipe | âœ… PASS | PrÃ©parÃ© pour Story 3.7 |
| 10 | Breadcrumb navigation | âœ… PASS | Projets > Nom projet |
| 11 | Loading state | âœ… PASS | ProjectDetailSkeleton |
| 12 | 404 si non trouvÃ© | âœ… PASS | Design avec bouton retour |

**Score:** 12/12 AC satisfaits

**Decision:** âœ… **APPROVED** - Story marquÃ©e Complete
