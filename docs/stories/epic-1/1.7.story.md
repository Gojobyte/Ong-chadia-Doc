# Story 1.7: User Management UI

## Status

**Done**

## Story

**As a** Super-Admin,
**I want** une interface pour gérer les utilisateurs,
**so that** je puisse créer des comptes, modifier les rôles et voir tous les utilisateurs.

## Acceptance Criteria

1. Page `/admin/users` accessible uniquement aux Super-Admins
2. Tableau listant tous les utilisateurs (nom, email, rôle, date création)
3. Pagination du tableau
4. Filtres par rôle
5. Bouton "Ajouter utilisateur" ouvrant un modal/formulaire
6. Formulaire de création : email, prénom, nom, rôle, mot de passe temporaire
7. Action "Modifier" sur chaque ligne ouvrant un formulaire d'édition
8. Action "Désactiver" avec confirmation
9. Indicateur visuel pour utilisateurs désactivés
10. Messages de succès/erreur (toasts)

## Tasks / Subtasks

- [x] **Task 1: Créer le service users.service.ts** (AC: 2-8)
  - [x] Créer `apps/web/src/services/users.service.ts`
  - [x] Fonction `getUsers(params)` - appelle GET /users avec pagination/filtres
  - [x] Fonction `getUserById(id)` - appelle GET /users/:id
  - [x] Fonction `createUser(data)` - appelle POST /users
  - [x] Fonction `updateUser(id, data)` - appelle PATCH /users/:id
  - [x] Fonction `deleteUser(id)` - appelle DELETE /users/:id

- [x] **Task 2: Créer le hook useUsers avec TanStack Query** (AC: 2-8)
  - [x] Créer `apps/web/src/hooks/useUsers.ts`
  - [x] Query `useUsers(params)` pour liste avec cache
  - [x] Query `useUser(id)` pour détail
  - [x] Mutation `useCreateUser()` avec invalidation cache
  - [x] Mutation `useUpdateUser()` avec invalidation cache
  - [x] Mutation `useDeleteUser()` avec invalidation cache

- [x] **Task 3: Créer le composant RoleGuard** (AC: 1)
  - [x] Créer `apps/web/src/components/auth/RoleGuard.tsx`
  - [x] Props: roles[] autorisés
  - [x] Vérifier le rôle utilisateur depuis le store
  - [x] Afficher message "Accès non autorisé" ou rediriger
  - [x] Utiliser Outlet pour routes enfants

- [x] **Task 4: Créer le composant UserTable** (AC: 2, 3, 7, 8, 9)
  - [x] Créer `apps/web/src/components/users/UserTable.tsx`
  - [x] Utiliser shadcn Table component
  - [x] Colonnes: Nom complet, Email, Rôle (badge), Date création, Actions
  - [x] Indicateur visuel (grisé ou badge) pour utilisateurs inactifs
  - [x] Menu actions avec "Modifier" et "Désactiver"
  - [x] Intégrer la pagination
  - [x] État loading avec skeleton

- [x] **Task 5: Créer le composant UserFormDialog** (AC: 5, 6, 7)
  - [x] Créer `apps/web/src/components/users/UserFormDialog.tsx`
  - [x] Utiliser shadcn Dialog component
  - [x] React Hook Form + Zod pour validation
  - [x] Mode création: tous les champs requis + password
  - [x] Mode édition: champs optionnels, sans password
  - [x] Select pour le rôle (SUPER_ADMIN, STAFF, CONTRIBUTOR, GUEST)
  - [x] Boutons Annuler/Sauvegarder avec état loading

- [x] **Task 6: Créer le composant RoleBadge** (AC: 2)
  - [x] Créer `apps/web/src/components/users/RoleBadge.tsx`
  - [x] Couleurs différentes par rôle (SUPER_ADMIN: rouge, STAFF: bleu, etc.)
  - [x] Utiliser shadcn Badge component

- [x] **Task 7: Créer le composant UsersFilter** (AC: 4)
  - [x] Créer `apps/web/src/components/users/UsersFilter.tsx`
  - [x] Select pour filtrer par rôle
  - [x] Option "Tous les rôles"
  - [x] Synchroniser avec URL params

- [x] **Task 8: Créer le composant ConfirmDialog** (AC: 8)
  - [x] Créer `apps/web/src/components/shared/ConfirmDialog.tsx`
  - [x] Props: title, message, onConfirm, onCancel
  - [x] Utiliser shadcn AlertDialog component
  - [x] État loading pendant l'action

- [x] **Task 9: Créer la page UsersPage** (AC: 1-10)
  - [x] Créer `apps/web/src/pages/UsersPage.tsx`
  - [x] Titre "Gestion des utilisateurs"
  - [x] Bouton "Ajouter utilisateur"
  - [x] Intégrer UsersFilter
  - [x] Intégrer UserTable
  - [x] Gérer l'état du dialog (création/édition)
  - [x] Afficher toasts de succès/erreur

- [x] **Task 10: Configurer les routes admin** (AC: 1)
  - [x] Ajouter route `/admin/users` dans App.tsx
  - [x] Wrapper avec RoleGuard pour SUPER_ADMIN uniquement
  - [x] Ajouter lien dans la navbar/sidebar (visible seulement pour Super-Admin)

- [x] **Task 11: Configurer les toasts** (AC: 10)
  - [x] Installer/configurer shadcn toast si pas déjà fait
  - [x] Ajouter Toaster dans App.tsx ou layout
  - [x] Utiliser useToast pour messages succès/erreur

## Dev Notes

### Dépendances Stories Précédentes

- **Story 1.5**: User Management API (endpoints CRUD)
- **Story 1.6**: Login & Auth UI (auth store, API client, layout)

### Frontend Architecture (Source: architecture/10-frontend-architecture.md)

```
apps/web/src/
├── components/
│   ├── auth/
│   │   └── RoleGuard.tsx          # Task 3
│   ├── users/
│   │   ├── UserTable.tsx          # Task 4
│   │   ├── UserFormDialog.tsx     # Task 5
│   │   ├── RoleBadge.tsx          # Task 6
│   │   └── UsersFilter.tsx        # Task 7
│   └── shared/
│       └── ConfirmDialog.tsx      # Task 8
├── pages/
│   └── UsersPage.tsx              # Task 9
├── hooks/
│   └── useUsers.ts                # Task 2
└── services/
    └── users.service.ts           # Task 1
```

### Users Service

```typescript
// apps/web/src/services/users.service.ts
import { api } from './api';
import { User, Role } from '@ong-chadia/shared';

export interface UsersParams {
  page?: number;
  limit?: number;
  role?: Role;
  isActive?: boolean;
}

export interface CreateUserInput {
  email: string;
  password: string;
  firstName: string;
  lastName: string;
  role: Role;
}

export interface UpdateUserInput {
  email?: string;
  firstName?: string;
  lastName?: string;
  role?: Role;
}

export interface PaginatedUsers {
  data: User[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
}

export const usersService = {
  async getUsers(params: UsersParams = {}): Promise<PaginatedUsers> {
    const response = await api.get('/users', { params });
    return response.data;
  },

  async getUserById(id: string): Promise<User> {
    const response = await api.get(`/users/${id}`);
    return response.data;
  },

  async createUser(data: CreateUserInput): Promise<User> {
    const response = await api.post('/users', data);
    return response.data;
  },

  async updateUser(id: string, data: UpdateUserInput): Promise<User> {
    const response = await api.patch(`/users/${id}`, data);
    return response.data;
  },

  async deleteUser(id: string): Promise<void> {
    await api.delete(`/users/${id}`);
  },
};
```

### useUsers Hook (TanStack Query)

```typescript
// apps/web/src/hooks/useUsers.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { usersService, UsersParams, CreateUserInput, UpdateUserInput } from '@/services/users.service';
import { useToast } from '@/components/ui/use-toast';

export function useUsers(params: UsersParams = {}) {
  return useQuery({
    queryKey: ['users', params],
    queryFn: () => usersService.getUsers(params),
  });
}

export function useUser(id: string) {
  return useQuery({
    queryKey: ['users', id],
    queryFn: () => usersService.getUserById(id),
    enabled: !!id,
  });
}

export function useCreateUser() {
  const queryClient = useQueryClient();
  const { toast } = useToast();

  return useMutation({
    mutationFn: (data: CreateUserInput) => usersService.createUser(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['users'] });
      toast({ title: 'Succès', description: 'Utilisateur créé avec succès' });
    },
    onError: (error: any) => {
      toast({
        title: 'Erreur',
        description: error.response?.data?.message || 'Erreur lors de la création',
        variant: 'destructive',
      });
    },
  });
}

export function useUpdateUser() {
  const queryClient = useQueryClient();
  const { toast } = useToast();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateUserInput }) =>
      usersService.updateUser(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['users'] });
      toast({ title: 'Succès', description: 'Utilisateur modifié avec succès' });
    },
    onError: (error: any) => {
      toast({
        title: 'Erreur',
        description: error.response?.data?.message || 'Erreur lors de la modification',
        variant: 'destructive',
      });
    },
  });
}

export function useDeleteUser() {
  const queryClient = useQueryClient();
  const { toast } = useToast();

  return useMutation({
    mutationFn: (id: string) => usersService.deleteUser(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['users'] });
      toast({ title: 'Succès', description: 'Utilisateur désactivé avec succès' });
    },
    onError: (error: any) => {
      toast({
        title: 'Erreur',
        description: error.response?.data?.message || 'Erreur lors de la désactivation',
        variant: 'destructive',
      });
    },
  });
}
```

### RoleGuard Component

```typescript
// apps/web/src/components/auth/RoleGuard.tsx
import { Navigate, Outlet } from 'react-router-dom';
import { useAuthStore } from '@/stores/auth.store';
import { Role } from '@ong-chadia/shared';

interface RoleGuardProps {
  roles: Role[];
}

export function RoleGuard({ roles }: RoleGuardProps) {
  const { user, isLoading } = useAuthStore();

  if (isLoading) {
    return <div className="flex items-center justify-center h-screen">Chargement...</div>;
  }

  if (!user || !roles.includes(user.role)) {
    return <Navigate to="/dashboard" replace />;
  }

  return <Outlet />;
}
```

### UserTable Component

```typescript
// apps/web/src/components/users/UserTable.tsx
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Button } from '@/components/ui/button';
import { MoreHorizontal, Pencil, UserX } from 'lucide-react';
import { User } from '@ong-chadia/shared';
import { RoleBadge } from './RoleBadge';
import { format } from 'date-fns';
import { fr } from 'date-fns/locale';

interface UserTableProps {
  users: User[];
  isLoading: boolean;
  onEdit: (user: User) => void;
  onDelete: (user: User) => void;
}

export function UserTable({ users, isLoading, onEdit, onDelete }: UserTableProps) {
  if (isLoading) {
    return <div className="animate-pulse">Chargement...</div>;
  }

  return (
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Nom</TableHead>
          <TableHead>Email</TableHead>
          <TableHead>Rôle</TableHead>
          <TableHead>Date de création</TableHead>
          <TableHead className="w-[50px]">Actions</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {users.map((user) => (
          <TableRow key={user.id} className={!user.isActive ? 'opacity-50' : ''}>
            <TableCell>
              {user.firstName} {user.lastName}
              {!user.isActive && <span className="ml-2 text-xs text-muted-foreground">(Désactivé)</span>}
            </TableCell>
            <TableCell>{user.email}</TableCell>
            <TableCell><RoleBadge role={user.role} /></TableCell>
            <TableCell>{format(new Date(user.createdAt), 'dd MMM yyyy', { locale: fr })}</TableCell>
            <TableCell>
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="ghost" size="icon">
                    <MoreHorizontal className="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  <DropdownMenuItem onClick={() => onEdit(user)}>
                    <Pencil className="mr-2 h-4 w-4" />
                    Modifier
                  </DropdownMenuItem>
                  {user.isActive && (
                    <DropdownMenuItem onClick={() => onDelete(user)} className="text-destructive">
                      <UserX className="mr-2 h-4 w-4" />
                      Désactiver
                    </DropdownMenuItem>
                  )}
                </DropdownMenuContent>
              </DropdownMenu>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  );
}
```

### UserFormDialog Component

```typescript
// apps/web/src/components/users/UserFormDialog.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Role, User } from '@ong-chadia/shared';

const createUserSchema = z.object({
  email: z.string().email('Email invalide'),
  password: z.string().min(8, 'Minimum 8 caractères'),
  firstName: z.string().min(1, 'Prénom requis'),
  lastName: z.string().min(1, 'Nom requis'),
  role: z.nativeEnum(Role),
});

const updateUserSchema = z.object({
  email: z.string().email('Email invalide').optional(),
  firstName: z.string().min(1).optional(),
  lastName: z.string().min(1).optional(),
  role: z.nativeEnum(Role).optional(),
});

interface UserFormDialogProps {
  open: boolean;
  onClose: () => void;
  onSubmit: (data: any) => Promise<void>;
  user?: User | null;
  isLoading: boolean;
}

export function UserFormDialog({ open, onClose, onSubmit, user, isLoading }: UserFormDialogProps) {
  const isEdit = !!user;
  const schema = isEdit ? updateUserSchema : createUserSchema;

  const { register, handleSubmit, formState: { errors }, reset, setValue, watch } = useForm({
    resolver: zodResolver(schema),
    defaultValues: user ? {
      email: user.email,
      firstName: user.firstName,
      lastName: user.lastName,
      role: user.role,
    } : {
      role: Role.GUEST,
    },
  });

  const handleFormSubmit = async (data: any) => {
    await onSubmit(data);
    reset();
    onClose();
  };

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>{isEdit ? 'Modifier l\'utilisateur' : 'Nouvel utilisateur'}</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label htmlFor="firstName">Prénom</Label>
              <Input id="firstName" {...register('firstName')} />
              {errors.firstName && <p className="text-red-500 text-sm">{errors.firstName.message}</p>}
            </div>
            <div>
              <Label htmlFor="lastName">Nom</Label>
              <Input id="lastName" {...register('lastName')} />
              {errors.lastName && <p className="text-red-500 text-sm">{errors.lastName.message}</p>}
            </div>
          </div>

          <div>
            <Label htmlFor="email">Email</Label>
            <Input id="email" type="email" {...register('email')} />
            {errors.email && <p className="text-red-500 text-sm">{errors.email.message}</p>}
          </div>

          {!isEdit && (
            <div>
              <Label htmlFor="password">Mot de passe temporaire</Label>
              <Input id="password" type="password" {...register('password')} />
              {errors.password && <p className="text-red-500 text-sm">{errors.password.message}</p>}
            </div>
          )}

          <div>
            <Label htmlFor="role">Rôle</Label>
            <Select
              value={watch('role')}
              onValueChange={(value) => setValue('role', value as Role)}
            >
              <SelectTrigger>
                <SelectValue placeholder="Sélectionner un rôle" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value={Role.SUPER_ADMIN}>Super Admin</SelectItem>
                <SelectItem value={Role.STAFF}>Staff</SelectItem>
                <SelectItem value={Role.CONTRIBUTOR}>Contributeur</SelectItem>
                <SelectItem value={Role.GUEST}>Invité</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <DialogFooter>
            <Button type="button" variant="outline" onClick={onClose}>
              Annuler
            </Button>
            <Button type="submit" disabled={isLoading}>
              {isLoading ? 'Enregistrement...' : 'Enregistrer'}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
```

### RoleBadge Component

```typescript
// apps/web/src/components/users/RoleBadge.tsx
import { Badge } from '@/components/ui/badge';
import { Role } from '@ong-chadia/shared';

const roleConfig: Record<Role, { label: string; variant: 'default' | 'secondary' | 'destructive' | 'outline' }> = {
  SUPER_ADMIN: { label: 'Super Admin', variant: 'destructive' },
  STAFF: { label: 'Staff', variant: 'default' },
  CONTRIBUTOR: { label: 'Contributeur', variant: 'secondary' },
  GUEST: { label: 'Invité', variant: 'outline' },
};

interface RoleBadgeProps {
  role: Role;
}

export function RoleBadge({ role }: RoleBadgeProps) {
  const config = roleConfig[role];
  return <Badge variant={config.variant}>{config.label}</Badge>;
}
```

### UsersPage Component

```typescript
// apps/web/src/pages/UsersPage.tsx
import { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { UserPlus } from 'lucide-react';
import { UserTable } from '@/components/users/UserTable';
import { UserFormDialog } from '@/components/users/UserFormDialog';
import { UsersFilter } from '@/components/users/UsersFilter';
import { ConfirmDialog } from '@/components/shared/ConfirmDialog';
import { useUsers, useCreateUser, useUpdateUser, useDeleteUser } from '@/hooks/useUsers';
import { User, Role } from '@ong-chadia/shared';

export function UsersPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [dialogOpen, setDialogOpen] = useState(false);
  const [editingUser, setEditingUser] = useState<User | null>(null);
  const [deletingUser, setDeletingUser] = useState<User | null>(null);

  const page = Number(searchParams.get('page')) || 1;
  const role = searchParams.get('role') as Role | undefined;

  const { data, isLoading } = useUsers({ page, limit: 20, role });
  const createMutation = useCreateUser();
  const updateMutation = useUpdateUser();
  const deleteMutation = useDeleteUser();

  const handleCreate = async (data: any) => {
    await createMutation.mutateAsync(data);
    setDialogOpen(false);
  };

  const handleUpdate = async (data: any) => {
    if (editingUser) {
      await updateMutation.mutateAsync({ id: editingUser.id, data });
      setEditingUser(null);
    }
  };

  const handleDelete = async () => {
    if (deletingUser) {
      await deleteMutation.mutateAsync(deletingUser.id);
      setDeletingUser(null);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Gestion des utilisateurs</h1>
        <Button onClick={() => setDialogOpen(true)}>
          <UserPlus className="mr-2 h-4 w-4" />
          Ajouter utilisateur
        </Button>
      </div>

      <UsersFilter
        role={role}
        onRoleChange={(newRole) => {
          if (newRole) {
            searchParams.set('role', newRole);
          } else {
            searchParams.delete('role');
          }
          setSearchParams(searchParams);
        }}
      />

      <UserTable
        users={data?.data || []}
        isLoading={isLoading}
        onEdit={(user) => setEditingUser(user)}
        onDelete={(user) => setDeletingUser(user)}
      />

      {/* Pagination */}
      {data && data.pagination.totalPages > 1 && (
        <div className="flex justify-center gap-2">
          <Button
            variant="outline"
            disabled={page === 1}
            onClick={() => {
              searchParams.set('page', String(page - 1));
              setSearchParams(searchParams);
            }}
          >
            Précédent
          </Button>
          <span className="py-2 px-4">
            Page {page} sur {data.pagination.totalPages}
          </span>
          <Button
            variant="outline"
            disabled={page === data.pagination.totalPages}
            onClick={() => {
              searchParams.set('page', String(page + 1));
              setSearchParams(searchParams);
            }}
          >
            Suivant
          </Button>
        </div>
      )}

      {/* Create Dialog */}
      <UserFormDialog
        open={dialogOpen}
        onClose={() => setDialogOpen(false)}
        onSubmit={handleCreate}
        isLoading={createMutation.isPending}
      />

      {/* Edit Dialog */}
      <UserFormDialog
        open={!!editingUser}
        onClose={() => setEditingUser(null)}
        onSubmit={handleUpdate}
        user={editingUser}
        isLoading={updateMutation.isPending}
      />

      {/* Delete Confirmation */}
      <ConfirmDialog
        open={!!deletingUser}
        onClose={() => setDeletingUser(null)}
        onConfirm={handleDelete}
        title="Désactiver l'utilisateur"
        message={`Êtes-vous sûr de vouloir désactiver ${deletingUser?.firstName} ${deletingUser?.lastName} ?`}
        isLoading={deleteMutation.isPending}
      />
    </div>
  );
}
```

### Composants shadcn/ui à utiliser

- `Table` - tableau des utilisateurs
- `Dialog` - formulaire création/édition
- `AlertDialog` - confirmation de désactivation
- `Button` - actions
- `Input` - champs formulaire
- `Select` - sélection du rôle
- `Badge` - badge du rôle
- `DropdownMenu` - menu actions
- `Toast` - notifications

### Routing (à ajouter dans App.tsx)

```typescript
// Dans App.tsx, ajouter dans les routes protégées:
import { RoleGuard } from '@/components/auth/RoleGuard';
import { UsersPage } from '@/pages/UsersPage';
import { Role } from '@ong-chadia/shared';

// Dans les Routes protégées:
<Route element={<RoleGuard roles={[Role.SUPER_ADMIN]} />}>
  <Route path="/admin/users" element={<UsersPage />} />
</Route>
```

### Testing

Pour cette story UI, tester manuellement:
- Accès refusé pour non-Super-Admin
- Affichage tableau avec pagination
- Filtrage par rôle fonctionne
- Création d'utilisateur via modal
- Modification d'utilisateur existant
- Désactivation avec confirmation
- Utilisateurs désactivés apparaissent grisés
- Toasts affichés correctement

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-21 | 1.0 | Story draft created | Bob (SM) |
| 2026-01-21 | 1.1 | PO Validation - APPROVED (9/10) | Sarah (PO) |
| 2026-01-22 | 1.2 | Implementation complete - All 11 tasks done | James (Dev) |
| 2026-01-23 | 1.3 | QA Review PASS - Gate approved | Quinn (QA) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Build passed with warning about chunk size (>500KB)
- All 100 tests passed

### Completion Notes List
- Created users.service.ts with CRUD functions
- Created useUsers hook with TanStack Query (queries and mutations)
- Created RoleGuard component for role-based route protection
- Created UserTable with skeleton loading, inactive user indicator, action menu
- Created UserFormDialog with React Hook Form + Zod validation (create/edit modes)
- Created RoleBadge with color-coded variants per role
- Created UsersFilter with role select synced to URL params
- Created ConfirmDialog with AlertDialog for delete confirmation
- Created UsersPage with full CRUD functionality and pagination
- Configured admin routes with RoleGuard in App.tsx
- Added "Utilisateurs" link in Sidebar (visible only for SUPER_ADMIN)
- Created toast system (Toast, Toaster, useToast)
- Added toast notifications to useUsers mutations
- Installed required dependencies (@tanstack/react-query, date-fns, radix-ui components)

### File List
**New Files:**
- `apps/web/src/services/users.service.ts`
- `apps/web/src/hooks/useUsers.ts`
- `apps/web/src/hooks/useToast.ts`
- `apps/web/src/components/auth/RoleGuard.tsx`
- `apps/web/src/components/users/UserTable.tsx`
- `apps/web/src/components/users/UserFormDialog.tsx`
- `apps/web/src/components/users/RoleBadge.tsx`
- `apps/web/src/components/users/UsersFilter.tsx`
- `apps/web/src/components/shared/ConfirmDialog.tsx`
- `apps/web/src/components/ui/table.tsx`
- `apps/web/src/components/ui/dialog.tsx`
- `apps/web/src/components/ui/alert-dialog.tsx`
- `apps/web/src/components/ui/select.tsx`
- `apps/web/src/components/ui/toast.tsx`
- `apps/web/src/components/ui/toaster.tsx`
- `apps/web/src/pages/UsersPage.tsx`

**Modified Files:**
- `apps/web/src/App.tsx` - Added admin routes with RoleGuard, Toaster
- `apps/web/src/components/layout/Sidebar.tsx` - Added admin link for Super-Admin
- `apps/web/src/components/ui/button.tsx` - Added buttonVariants export
- `apps/web/package.json` - Added dependencies

---

## QA Results

### Review Date: 2026-01-23

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: Excellent** - L'implémentation est propre, bien structurée et suit les bonnes pratiques React/TypeScript.

**Points forts:**
- Séparation claire des composants (UserTable, UserFormDialog, RoleBadge, etc.)
- Utilisation correcte de TanStack Query avec invalidation du cache
- React Hook Form + Zod pour la validation des formulaires
- États de chargement (skeleton) bien implémentés
- Gestion correcte du reset du formulaire lors de l'ouverture du dialog

**Architecture:**
- Service layer (users.service.ts) bien isolé
- Custom hooks (useUsers.ts) encapsulant la logique de data fetching
- Composants UI réutilisables (ConfirmDialog, RoleBadge)

### Refactoring Performed

Aucun refactoring nécessaire - le code est de bonne qualité.

### Compliance Check

- Coding Standards: ✓ TypeScript strict, composants fonctionnels, hooks personnalisés
- Project Structure: ✓ Fichiers dans les bons dossiers (components/users, hooks, services, pages)
- Testing Strategy: ✓ UI story - tests manuels spécifiés, 100 tests backend passent
- All ACs Met: ✓ Toutes les 10 acceptance criteria sont implémentées

### Requirements Traceability

| AC | Description | Implementation | Status |
|----|-------------|----------------|--------|
| 1 | Page `/admin/users` Super-Admin only | RoleGuard.tsx + App.tsx routes | ✅ |
| 2 | Tableau utilisateurs (nom, email, rôle, date) | UserTable.tsx | ✅ |
| 3 | Pagination du tableau | UsersPage.tsx (lines 101-124) | ✅ |
| 4 | Filtres par rôle | UsersFilter.tsx | ✅ |
| 5 | Bouton "Ajouter utilisateur" | UsersPage.tsx line 72 | ✅ |
| 6 | Formulaire création complet | UserFormDialog.tsx | ✅ |
| 7 | Action "Modifier" | UserTable.tsx + UserFormDialog | ✅ |
| 8 | Action "Désactiver" avec confirmation | ConfirmDialog.tsx | ✅ |
| 9 | Indicateur visuel désactivé | UserTable.tsx lines 64-75 | ✅ |
| 10 | Messages succès/erreur (toasts) | useUsers.ts + useToast.ts | ✅ |

### Improvements Checklist

- [x] Tous les ACs implémentés
- [x] Code TypeScript strict sans erreurs
- [x] Build passe avec succès
- [x] Composants bien structurés et réutilisables
- [x] Gestion des états loading/error
- [x] Form reset corrigé (ajout de `open` aux dépendances useEffect)
- [ ] (Futur) Ajouter tests E2E pour le parcours utilisateur complet
- [ ] (Futur) Considérer l'ajout d'un champ de recherche par nom/email

### Security Review

**Status: PASS**
- ✓ Contrôle d'accès basé sur les rôles (RoleGuard) correctement implémenté
- ✓ Redirection vers /dashboard si accès non autorisé
- ✓ Pas d'exposition de données sensibles
- ✓ Mot de passe non affiché en mode édition
- ✓ Validation côté client avec Zod

### Performance Considerations

**Status: PASS**
- ✓ TanStack Query avec staleTime de 5 minutes pour le caching
- ✓ Invalidation sélective du cache après mutations
- ✓ Skeleton loading pour une meilleure UX
- ✓ Pagination côté serveur (limit: 20)

### Files Modified During Review

Aucun fichier modifié pendant la revue - implémentation conforme.

### Gate Status

**Gate: PASS** → docs/qa/gates/1.7-user-management-ui.yml

### Recommended Status

✓ **Ready for Done** - Toutes les acceptance criteria sont satisfaites, le code est de bonne qualité, et aucun problème bloquant n'a été identifié.
