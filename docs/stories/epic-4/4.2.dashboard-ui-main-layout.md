# Story 4.2: Dashboard UI - Main Layout

## Status

Complete

## Story

**As a** utilisateur authentifié,
**I want** voir un tableau de bord avec vue d'ensemble dès ma connexion,
**so that** je puisse rapidement accéder aux informations importantes.

## Acceptance Criteria

1. Page `/dashboard` définie comme page d'accueil après login
2. Layout responsive avec grille de widgets/cards
3. Header avec : Bienvenue {prénom}, date du jour
4. Navigation principale (sidebar ou top nav) vers : Dashboard, Documents, Projets, Admin (si autorisé)
5. Skeleton loading pendant chargement des données
6. Gestion d'erreur si API échoue (retry, message)
7. Bouton de rafraîchissement manuel
8. Design cohérent avec la charte (couleurs, typographie)
9. Adapté mobile : cards empilées verticalement
10. Temps de chargement initial < 2 secondes

## Tasks / Subtasks

- [x] **Task 1: Créer le hook useDashboard**
  - [x] `useDashboard()` - Appelle GET /api/dashboard
  - [x] `useDashboardActivity(page)` - Appelle GET /api/dashboard/activity
  - [x] Gestion du loading, error, refetch
  - [x] Refresh automatique toutes les 5 minutes

- [x] **Task 2: Mettre à jour DashboardPage**
  - [x] Remplacer les données statiques par les données API
  - [x] Intégrer le hook useDashboard
  - [x] Ajouter skeleton loading pour chaque section
  - [x] Ajouter gestion d'erreur avec retry

- [x] **Task 3: Améliorer le header**
  - [x] Afficher "Bienvenue {prénom}"
  - [x] Afficher la date du jour formatée
  - [x] Bouton de rafraîchissement manuel

- [x] **Task 4: Améliorer la responsivité**
  - [x] Grid responsive (1 col mobile, 2 cols tablet, 3 cols desktop)
  - [x] Cards empilées verticalement sur mobile
  - [x] Navigation adaptée mobile (existant dans DashboardLayout)

- [x] **Task 5: Créer les skeletons**
  - [x] Skeleton pour stats cards
  - [x] Skeleton pour table projets
  - [x] Skeleton pour documents/deadlines

## Dev Notes

### État actuel

Le fichier `apps/web/src/pages/DashboardPage.tsx` existe déjà avec :
- Layout de base avec stats, documents récents, activité
- Données statiques (mock)
- QuickAccessWidget

### Modifications nécessaires

```typescript
// apps/web/src/hooks/useDashboard.ts
import { useQuery } from '@tanstack/react-query';
import { api } from '@/services/api';

export function useDashboard() {
  return useQuery({
    queryKey: ['dashboard'],
    queryFn: async () => {
      const response = await api.get('/dashboard');
      return response.data;
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
    refetchInterval: 5 * 60 * 1000,
  });
}

export function useDashboardActivity(page: number = 1) {
  return useQuery({
    queryKey: ['dashboard', 'activity', page],
    queryFn: async () => {
      const response = await api.get('/dashboard/activity', {
        params: { page, limit: 10 }
      });
      return response.data;
    },
  });
}
```

### Skeleton components

```tsx
function StatsSkeleton() {
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      {[1, 2, 3].map((i) => (
        <Card key={i} className="animate-pulse">
          <div className="h-4 bg-slate-200 rounded w-24 mb-2" />
          <div className="h-8 bg-slate-200 rounded w-16 mb-2" />
          <div className="h-3 bg-slate-200 rounded w-32" />
        </Card>
      ))}
    </div>
  );
}
```

### Fichiers concernés

```
apps/web/src/
├── pages/DashboardPage.tsx (modifier)
├── hooks/useDashboard.ts (créer)
├── services/dashboard.service.ts (créer)
└── components/dashboard/
    ├── DashboardSkeleton.tsx (créer)
    └── QuickAccessWidget.tsx (existant)
```

## Testing

### Tests recommandés

1. **Chargement**
   - Skeleton affiché pendant loading
   - Données affichées après chargement
   - Erreur gérée proprement

2. **Responsivité**
   - Layout correct sur mobile
   - Layout correct sur desktop

3. **Rafraîchissement**
   - Bouton refresh fonctionne
   - Auto-refresh toutes les 5 min

## Dependencies

- **Requires**: Story 4.1 (Dashboard API)
- **Blocks**: None

---

## PO Review

**Reviewed by:** Sarah (PO)
**Date:** 2026-01-27
**Status:** ✅ Approved for Development

### Review Notes
- Acceptance criteria well-defined (10 criteria)
- Hook pattern (useDashboard) is the correct approach for data fetching
- Skeleton loading ensures good UX during data fetch
- Auto-refresh (5 min) matches API cache TTL - good design
- Performance requirement explicit (< 2s initial load)

### Recommendations
- Existing DashboardPage.tsx can be refactored progressively
- Ensure error boundary wraps the dashboard for graceful degradation

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-27 | 1.0 | Création initiale de la story | Sarah (PO) |
| 2026-01-27 | 1.1 | PO Review - Approved for Development | Sarah (PO) |
