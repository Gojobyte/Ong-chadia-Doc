# Story 4.3: Dashboard UI - Projects Widget

## Status

Complete

## Story

**As a** utilisateur,
**I want** voir mes projets actifs sur le dashboard,
**so that** je puisse accéder rapidement à mes projets en cours.

## Acceptance Criteria

1. Widget "Mes Projets" affichant les 5 projets récents de l'utilisateur
2. Chaque projet montre : Nom, Statut (badge), Date fin
3. Indicateur visuel si deadline proche (< 7 jours)
4. Clic sur un projet navigue vers sa page de détail
5. Lien "Voir tous les projets" vers `/projects`
6. État vide : "Aucun projet assigné" avec lien vers liste projets
7. Compteur de projets par statut (mini graphique ou badges)
8. Bouton "Nouveau projet" (si autorisé)
9. Widget responsive (s'adapte à la largeur)
10. Chargement asynchrone indépendant

## Tasks / Subtasks

- [x] **Task 1: Créer le composant ProjectsWidget**
  - [x] Créer `apps/web/src/components/dashboard/ProjectsWidget.tsx`
  - [x] Afficher liste des 5 projets récents
  - [x] Badge statut avec couleur appropriée
  - [x] Date de fin formatée

- [x] **Task 2: Implémenter les indicateurs visuels**
  - [x] Badge rouge si deadline < 7 jours
  - [x] Badge orange si deadline < 14 jours
  - [x] Compteur par statut (draft, preparation, inProgress, completed)

- [x] **Task 3: Gérer les interactions**
  - [x] Clic sur projet → navigation vers /projects/{id}
  - [x] Lien "Voir tous" → /projects
  - [x] Bouton "Nouveau projet" si permission

- [x] **Task 4: Gérer les états**
  - [x] Skeleton loading
  - [x] État vide avec message
  - [x] État erreur (via parent)

- [x] **Task 5: Intégrer au dashboard**
  - [x] Ajouter ProjectsWidget dans DashboardPage
  - [x] Utiliser données de useDashboard()

## Dev Notes

### Composant ProjectsWidget

```tsx
// apps/web/src/components/dashboard/ProjectsWidget.tsx
import { Link } from 'react-router-dom';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { FolderKanban, Plus, ArrowUpRight, AlertCircle } from 'lucide-react';
import { formatDistanceToNow, differenceInDays, parseISO } from 'date-fns';
import { fr } from 'date-fns/locale';

interface Project {
  id: string;
  name: string;
  status: 'DRAFT' | 'PREPARATION' | 'IN_PROGRESS' | 'COMPLETED';
  endDate: string | null;
}

interface ProjectsWidgetProps {
  projects: Project[];
  projectStats: {
    total: number;
    byStatus: Record<string, number>;
  };
  isLoading?: boolean;
  canCreate?: boolean;
}

const STATUS_CONFIG = {
  DRAFT: { label: 'Brouillon', variant: 'neutral' },
  PREPARATION: { label: 'Préparation', variant: 'warning' },
  IN_PROGRESS: { label: 'En cours', variant: 'info' },
  COMPLETED: { label: 'Terminé', variant: 'success' },
};

export function ProjectsWidget({
  projects,
  projectStats,
  isLoading,
  canCreate
}: ProjectsWidgetProps) {
  if (isLoading) {
    return <ProjectsWidgetSkeleton />;
  }

  const getDeadlineStatus = (endDate: string | null) => {
    if (!endDate) return null;
    const days = differenceInDays(parseISO(endDate), new Date());
    if (days < 0) return 'overdue';
    if (days < 7) return 'critical';
    if (days < 14) return 'warning';
    return null;
  };

  return (
    <Card>
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <FolderKanban className="w-5 h-5 text-primary-600" />
          <h3 className="font-semibold text-slate-900">Mes Projets</h3>
          <Badge variant="neutral">{projectStats.total}</Badge>
        </div>
        {canCreate && (
          <Button variant="ghost" size="sm" asChild>
            <Link to="/projects/new">
              <Plus className="w-4 h-4" />
            </Link>
          </Button>
        )}
      </div>

      {/* Status counters */}
      <div className="flex gap-2 mb-4">
        {Object.entries(projectStats.byStatus).map(([status, count]) => (
          <Badge
            key={status}
            variant={STATUS_CONFIG[status]?.variant || 'neutral'}
            size="sm"
          >
            {count} {STATUS_CONFIG[status]?.label || status}
          </Badge>
        ))}
      </div>

      {projects.length === 0 ? (
        <div className="text-center py-6 text-slate-500">
          <FolderKanban className="w-8 h-8 mx-auto mb-2 text-slate-300" />
          <p>Aucun projet assigné</p>
          <Link
            to="/projects"
            className="text-primary-600 text-sm hover:underline"
          >
            Voir tous les projets
          </Link>
        </div>
      ) : (
        <div className="space-y-3">
          {projects.map((project) => {
            const deadlineStatus = getDeadlineStatus(project.endDate);
            return (
              <Link
                key={project.id}
                to={`/projects/${project.id}`}
                className="flex items-center justify-between p-3 rounded-lg hover:bg-slate-50 transition-colors"
              >
                <div className="flex-1 min-w-0">
                  <p className="font-medium text-slate-900 truncate">
                    {project.name}
                  </p>
                  <div className="flex items-center gap-2 mt-1">
                    <Badge variant={STATUS_CONFIG[project.status]?.variant}>
                      {STATUS_CONFIG[project.status]?.label}
                    </Badge>
                    {project.endDate && (
                      <span className="text-xs text-slate-500">
                        {formatDistanceToNow(parseISO(project.endDate), {
                          addSuffix: true,
                          locale: fr
                        })}
                      </span>
                    )}
                  </div>
                </div>
                {deadlineStatus && (
                  <AlertCircle
                    className={`w-5 h-5 ${
                      deadlineStatus === 'critical' ? 'text-red-500' :
                      deadlineStatus === 'warning' ? 'text-orange-500' :
                      'text-slate-400'
                    }`}
                  />
                )}
              </Link>
            );
          })}
        </div>
      )}

      <Link
        to="/projects"
        className="flex items-center justify-center gap-1 mt-4 text-sm text-primary-600 hover:text-primary-700"
      >
        Voir tous les projets
        <ArrowUpRight className="w-4 h-4" />
      </Link>
    </Card>
  );
}
```

### Fichiers concernés

```
apps/web/src/components/dashboard/
├── ProjectsWidget.tsx (créer)
└── index.ts (mettre à jour)
```

## Testing

### Tests recommandés

1. **Affichage**
   - Liste des projets correcte
   - Badges statut corrects
   - Indicateurs deadline visibles

2. **Navigation**
   - Clic projet → page détail
   - Lien "Voir tous" → /projects

3. **États**
   - Skeleton pendant loading
   - Message si aucun projet

## Dependencies

- **Requires**: Story 4.1 (Dashboard API), Story 4.2 (Dashboard Layout)
- **Blocks**: None

---

## PO Review

**Reviewed by:** Sarah (PO)
**Date:** 2026-01-27
**Status:** ✅ Approved for Development

### Review Notes
- Acceptance criteria comprehensive (10 criteria)
- Deadline indicators (7/14 days) provide good visual urgency cues
- Status badge configuration well-structured
- Permission-aware (canCreate prop)
- Empty state properly handled

### Recommendations
- Component code in dev notes is production-ready, can be used directly
- Consider adding tooltips for deadline status icons

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-27 | 1.0 | Création initiale de la story | Sarah (PO) |
| 2026-01-27 | 1.1 | PO Review - Approved for Development | Sarah (PO) |
